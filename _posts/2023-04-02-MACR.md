---
title:  Model-Agnostic Counterfactual Reasoning for Eliminating Popularity Bias in Recommender System(KDD 2021)

excerpt: Causal Inference, Recommendation System, KDD 

toc : true
toc_sticky : true  

use_math: true

categories:
  - papers
tags:
  - papers
  - MACR
  - causal
  - recsys
---

# 0. Abstract 

- 추천 시스템의 목적은 단순히 인기 많은 아이템을 추천하는 것이 아니라 개개인에 맞는 아이템을 추천하는 것에 있다.
- 하지만 보통의 추천 모델 훈련 패러다임은 모델이 인기 많은 아이템들이 더 많이 추천하고 그 결과 더 인기가 많아지도록 편향되게 만든다.
- 논문에서는 이러한 인기 편향(Popularity Bias) 을  Counterfactual Reasoning 관점에서 해석한다.
- 그것은 '추천 시스템 모형이 아이템의 특성만을 사용한다면 순위 점수는 어떻게 될까?' 라는 반사실적 질문에 답하는 것이다.
- 이 논문에서는 이를 위해 훈련 과정에서 멀티 테스크 러닝을 수행하였고 검증 과정에서 인기 편향 제거를 위한 Counterfactual Reasoning 을 수행하였다.
- 제시하는 방법론은 기존 추천 시스템 모델에 쉽게 적용할 수 있으며 5개의 실제 데이터셋에서 MF 와 LightGCN 모델을 이용한 실험으로 이를 입증하였다. 


# 1. Introduction

![Popularity Bias](https://github.com/Sodychoe/sodychoe.github.io/blob/main/assets/images/papers/macr/macr-bias.png?raw=true)
<div style="text-align: center;">Figure 1 :</div>



# 2. Problem Definition

$$\mathcal{U} = \{u_1, u_2, \cdots, u_n \},$$  그리고 $$\mathcal{I}=\{i_1, i_2, \cdots, i_m \}$$ 을 각각 유저와 아이템 집합이라고 하자. 그러면 유저와 아이템의 상호작용은 다음과
같이 나타낼 수 있다. 
$$y_{ui}= \begin{cases} 1 \hspace{4mm} \text{if user} \, u \, \text{has interacted with item} \, i  
\\ 0 \hspace{4mm} \text{otherwise.} \end{cases}$$

Scoring function 을 $f(u, i|\theta)$ 라고 하자. 추천 시스템 모형의 훈련 단계에서는 유저와 아이템의 상호작용 $Y =\{y_{ui}\}_{n \times m} $ 로부터 Scoring function 을 학습하여 유저의 선호도를 예측하는 모형을 만든다. 보통 훈련 데이터셋과 테스트 데이터셋을 
만들 때는 랜덤하게 하거나 시간에 따라 분할한다. 하지만 논문에서는 평가 단계에서 기존의 평가 방법이 인기 편향에 존재 때문에 유저의 진정한
선호도를 반영하지 못한다고 주장한다. 편향을 제거한 평가 방법을 수행하기 위해 논문에서는 선행 연구를 참고하여 테스트 데이터를 균등 분포에서
샘플링하는 평가 방식을 따랐다.   

# 3. Methodology

## 3.1 Preliminaries
<!-- ![](https://user-images.githubusercontent.com/113276452/238668969-2485be1e-4887-4543-affc-a92c08142a15.png) -->

![](https://user-images.githubusercontent.com/113276452/238672592-377408fd-0068-43d7-a67a-391331a8f071.png)
<div style="text-align: center;">Figure 2 :</div>

- Causal Graph : figure 2를 참고하자. 그래프에서 node 들은 변수를 나타내고 화살표는 인과 관계를 나타낸다. 제일 왼쪽에 있는 그래프를 보면
변수 I가 변수 Y 와 K 의 원인이고, 변수 K는 다시 변수 Y의 원인이라고 해석할 수 있다. 이때 두 경로 I --> Y 와 I --> K --> Y 를 보면 전자의
경로는 I 의 효과가 직접적으로 Y의 전달되는데 후자의 경로는 I 의 효과가 K 를 거쳐서 Y 에 전달된다. **이를 각각 Direct Path 와 Indirect Path 라고 한다.** 그리고 Indirect Path 에서 I 는 mediator K 를 거친 indirect effect 를 가진다고 한다. 이 경우 Y 는 다음과
같은 형태의 함수로 쓸 수 있다. 

$$Y_{i, k} = Y(I=i, K=k)$$


- Causal Effect : I --> Y 에서의 Causal Effect 라는 것은 I의 변화에 따라 Y가 어느 정도 변화하는지를 나타내는 수치가 된다. Figure 2의 그래프 위에서 I의 Y에 대한 Causal Effect, Total Effect(TE) 를 계산하면 다음과 같다. 

$$TE = Y_{i, k_{i}} - Y_{i^{*},k_{i^{*}}}$$

> 이 값은 서로 다른 값 $i, i^{*}$ 가 주어진 두 상황에서의 Y값의 차이가 된다. 빼주는 값을 기준이라고 생각하자. 기준보다 얼마나 많이 변화하는지를 측정하는 것이다. 여기서 우리는 TE 를 direct path 에서의 effect와
> indirect path 에서의 effect 로 분해할 수 있다. 
> 
> Figure2 에서 보이는 3가지 그림은  TE 를 분해하는 논리적인 과정을 그림으로 나타낸 것이다. 여기서 우리는 Counterfactual reasoning, 반사실적 사고를 통해 causal effect를 구해볼 수 있다. 

TE는 
1. Direct Path 에서의 Natural Direct Effect(NDE)  
2. Indirect Path 에서의 Total Indirect Effect(TIE) 

로 분리될 수 있다. 이떄 NDE 의 수식은 다음과 같다.

$$NDE = Y_{i, k_{i^*}}-Y_{i^{*},k_{i^*}}$$

1. NDE 는 K 를 기준 값 $$i^{*}$$ 에 해당하는 값으로 고정하고, $$i^* \rightarrow i$$ 의 변화에 따른 Y의 변화량을 의미한다. 
2. 여기서 $$Y_{i^{*},k_{i^*}}$$ 는 정의상 변수 $$I$$ 의 값을 path 에 따라 다르게 주어야 하므로 counterfactual 한 값이다. 

이 값을 이용하여 (어떻게 구현하는지는 나중에 알아보고...) TIE 를 구할 수 있다.

$$TIE = TE - NDE = Y_{i,K_i} - Y_{i,K_{i^{*}}}.$$

## 3.2 Causal Look at Recommendation

## 3.3 Model-Agnostic Counterfactual Reasoning

## 3.4 Rationality of the Debiased Inference

## 3.5 Discussion

# 4. Experiments 

## 4.1 Experiment Settings

## 4.2 Results

## 4.3 Case Study

# 5. Related Work

## 5.1 Popularity Bias in Recommendation

## 5.2 Causal Inference in Recommendation

# 6. Conclusion and Future Work 
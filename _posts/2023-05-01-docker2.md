---
title:  "Docker 로 실험 환경 구축하기 (2)"

excerpt: Docker

toc : true
toc_sticky : true  

use_math: true

categories:
  - devops
tags:
  - devops
  - Docker
---

VSC 의 익스텐션을 이용하여 보다 손쉽게 Docker Container 를 활용하는 방법을 알아보자. 

# 1. Visual Studio Code(VSC) 확장 설치하기

VSC 에서 익스텐션들을 설치한다.

![](https://user-images.githubusercontent.com/113276452/236612870-b3a656c2-4bed-4468-85a3-bb0b36c3f217.png)

![](https://user-images.githubusercontent.com/113276452/236612872-ce9c2868-c531-43e6-bc46-f7cdeabf0f10.png)

이제 vsc 위에서 도커 이미지와 컨테이너를 관리하고,
MS 에서 제공하는 컨테이너 실행 자동화 기능들을 이용할 수 있다. 

# 2. VSC 에서 Container 개발환경 구축하기 

깨끗하게 빈 프로젝트 폴더를 하나 만들자.

dev-container 익스텐션 설치 후 명령 팔레트를 열면 

ADD Dev Container Configuration Files 가 추가되어있다. 이걸 클릭하면 미리 구성된 이미지 탬플릿들이

나오는데 여기서 python 을 검색해보면 다음과 같다.

![](https://user-images.githubusercontent.com/113276452/236620191-134a7718-3542-4f13-9884-e9f6d9ca26a7.png)

나는 여기서 python3 를 선택하고 3.10 버전의 이미지를 선택했다. 이걸 눌러보면 

.devcontainer 이란 폴더가 devcontainer.json 파일을 포함하여 프로젝트에 추가된 것을 확인할 수 있다.

여기서 다시 명령 팔레트 창을 열어서 reopen in container 을 실행한다. 그럼 VSC 새 창이 열리고 python 3.10 이 

설치된 컨테이너 환경으로 접속된 것을 확인할 수 있다. 실제로 파이썬 코드를 실행해보면 잘 돌아간다. 

![](https://user-images.githubusercontent.com/113276452/236620789-4bb79cce-cea5-4fb6-a08c-8189adeaa71a.png)

<!-- 아래는 내가 만든 Graph Neural Network(GNN) 학습을 위한 Dockerfile 예시이다. 

<script src="https://gist.github.com/Sodychoe/74d3f4890abdf5fabe500e7a967dfb75.js"></script> -->

# 3. 컨테이너 실행 후 업데이트하기 

도커 컨테이너는 기본적으로는 데이터를 보존하지 못한다. 그래서 우리가 구축한 컨테이너를 업데이트해야할 경우,
예를 들어서 새로운 파이썬 패키지를 설치한다던가 하는 이유로 개발 환경에 변경이 있을 경우 컨테이너를 새로 빌드해야한다.
vsc 의 dev-contatiner 익스텐션은 devcontainer.json 파일에 설정을 저장하여 이런 변경과정을 자동화 할 수 있다. 내 디렉토리에 만들어진 json 파일은 다음과 같다.

![](https://user-images.githubusercontent.com/113276452/236658949-606e5cf0-f37a-4cfc-8ee3-602ae01a85df.png)

여기서 'postCreateCommand' 부분의 주석을 푼다. 그러면 컨테이너가 만들어지고 반드시 실행되야 하는 명령어가
지정되게 된다. 여기선 'pip3 install --user -r requirements.txt' 가 기본 설정으로 되어 있다.
파이썬 개발자가 requirements.txt 파일에 개발환경을 추가했을 경우, 컨테이너를 빌드할 때마다 자동으로 개발환경을
업데이트하게 된다. 

다음으로는 'customizations' 부분을 변경해 보자. 이 부분에서 사용자가 변경할 수 있는 것 중 하나는 
컨테이너 빌드 시에 반드시 설치되야 할 vsc 익스텐션을 지정할 수 있다는 점이다. 이 부분은 매우 간단하게 적용할 수 있다. vsc 확장 탭에서 원하는 확장을 오른쪽 클릭하면 'devcontainer.json 에 추가' 를 누르면 자동으로
'customizations' 에 추가되기 때문이다! 나는 파이썬을 jupyter interactive 로 실행하는 것을 선호하기 때문에
python extension pack 과 jupyter 확장을 컨테이너 빌드 시에 자동으로 설치되도록 설정하였다. 

![](https://user-images.githubusercontent.com/113276452/236659826-e81a58dd-f774-4000-9450-1083250633b4.png)

![](https://user-images.githubusercontent.com/113276452/236659865-cd57a0e7-af29-4812-8ccb-e5ad15edb8fb.png)

VSC 의 Dev-Container 확장을 이용하여 도커 환경을 손쉽게 구성하는 방법을 알아보았다. 도커 환경을 편리하게 구성하고, 익숙한 vsc 환경을 그대로 구성할 수 있다는 점이 좋아서 앞으로 도커 환경을 만들 때 많이 사용할 것 같다.

# 4. References 

1. [https://code.visualstudio.com/docs/devcontainers/create-dev-container](https://code.visualstudio.com/docs/devcontainers/create-dev-container)
1. [https://code.visualstudio.com/docs/devcontainers/containers](https://code.visualstudio.com/docs/devcontainers/containers)
1. [https://learn.microsoft.com/ko-kr/training/modules/use-docker-container-dev-env-vs-code/](https://learn.microsoft.com/ko-kr/training/modules/use-docker-container-dev-env-vs-code/)